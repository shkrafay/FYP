<!DOCTYPE html>
<html lang="en">
<head>
    <title>Expressions</title>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <link href="https://fonts.googleapis.com/css?family=Work+Sans:100,200,300,400,500,600,700,800,900" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css?family=Fredericka+the+Great" rel="stylesheet">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Shadows+Into+Light&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Rubik+Distressed&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="css/style.css"/>
    <link href="http://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.3.0/css/font-awesome.css"
          rel="stylesheet"  type='text/css'>
    <script src="https://unpkg.com/sweetalert/dist/sweetalert.min.js"></script>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
</head>
<body>
<nav class="navbar navbar-expand-lg navbar-dark bg-dark ftco_navbar ftco-navbar-light" id="ftco-navbar">
    <div class="container d-flex align-items-center">
        <a class="navbar-brand" style="font-family: 'Shadows Into Light', cursive;" href="index.html">Facial Sentiment
            Analyzer</a>
        <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#ftco-nav"
                aria-controls="ftco-nav" aria-expanded="false" aria-label="Toggle navigation">
            <span class="oi oi-menu"></span> Menu
        </button>
        <div class="collapse navbar-collapse" id="ftco-nav">
            <ul class="navbar-nav ml-auto">
                <li class="nav-item"><a href="index.html" class="nav-link pl-0">Home</a></li>
                <li class="nav-item"><a href="click-predict.html" class="nav-link">Click & Predict</a></li>
                <li class="nav-item active"><a href="monitoring.html" class="nav-link">Intelligent Monitoring</a></li>
                <li class="nav-item"><a href="music.html" class="nav-link">Music for Mood</a></li>
                <li class="nav-item"><a href="blog.html" class="nav-link">Blog</a></li>
                <li class="nav-item"><a href="about.html" class="nav-link">About</a></li>
            </ul>
        </div>
    </div>
</nav>
<style>
        .center-items {
            margin-right: auto;
            margin-left: auto;
        }

        .bg-yellow {
            background-color: #ffc501;
        }

        .heading-font {
            font-family: 'Rubik Distressed', cursive;
            color: white
        }

        .bg-mairoon {
            background-color: #B95836;
        }

        .bg-sad {
            background-color: #6E7C5E;
        }

        .bg-surprise {
            background-color: #d3a9ab;
        }

        .bg-sleepy {
            background-color: #242c3d
        }

        .bg-grey {
            background-color: #343a40;
        }

        .bg-light-grey {
            background-color: #6c757d;
        }
    </style>
    <section class="hero-wrap hero-wrap-2" style="background-image:url(images/Monitoring.jpg)">
        <div class="overlay"></div>
        <div class="container">
            <div class="row no-gutters slider-text align-items-center justify-content-center">
                <div class="col-md-9 ftco-animate text-center">
                    <h1 class="mb-2 bread">Intelligent Monitoring</h1>
                    <p class="breadcrumbs"><span class="mr-2"><a href="index.html">Home <i
                                        class="ion-ios-arrow-forward"></i></a></span> <a href="monitoring.html"><span>Monitoring <i
                                        class="ion-ios-arrow-forward"></i></span></a></p>
                </div>
            </div>
        </div>
    </section>
    <section class="ftco-section ftco-no-pb">
        <div class="container mb-5">
            <div class="row">
                <div class="col-md-12 text-center" id="vide-sec" style="display: none;">
                    <video style="position: relative" id="video" width="450" height="350" autoplay></video>
                    <button style="position: absolute; object-fit: cover; margin-left: -280px; margin-top: 300px"
                            class="text-center btn btn-tertiary px-3" id="stop-btn">Stop & Analyze
                    </button>
                </div>
                <div class="col-md-12">
                    <div class="row" id="initial-btns">
                        <div class="col-md-12 mb-5 d-flex justify-content-center align-items-center">
                            <h5>Click on the 'Start Monitoring' Button to immediately start analyzing the Meeting/Video
                                Feed.</h5>
                        </div>
                        <div class="col-md-12 mb-5 d-flex justify-content-center align-items-center">
                                <button class="text-center btn btn-primary px-4 py-2" id="start-camera">Start Monitoring
                                </button>
                        </div>
                    </div>
                    <div class="col-12 mb-5" id="div-canvas"
                         style="display: none; margin-left: auto; margin-right: auto; ">
                        <canvas id="canvas" style="position: relative" width="450" height="350">
                            <div class="output">
                                <img id="photo" alt="The screen capture will appear in this box.">
                            </div>
                        </canvas>

                        <button style="position: absolute; object-fit: cover; margin-left: -300px; margin-top: 306px"
                                class="text-center btn btn-tertiary px-3" id="check-expression">Check Expressions
                        </button>
                    </div>
                    <span id="res"></span>
                </div>
            </div>
    </section>
    <section class="ftco-services ftco-no-pb" id="results" style="display: none">
        <div class="container-wrap">
            <div class="row no-gutters">
                <div class="col-md-12">
                    <div class="row no-gutters">
                        <div class="col-md-4 d-flex services align-self-stretch pb-4 px-4 ftco-animate bg-grey">
                            <div class="media block-6 d-block text-center center-items">
                                <div class="media-body p-2 mt-3 text-center">
                                    <h3>Total Faces detected</h3>
                                    <h1 id="total-faces" class="text-center heading-font">0</h1>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-4 d-flex services align-self-stretch pb-4 px-4 ftco-animate bg-light-grey">
                            <div class="media block-6 d-block text-center center-items">
                                <div class="media-body p-2 mt-3">
                                    <h3>Dominated Emotion</h3>
                                    <h1 id="dominated-emotion" class="text-center heading-font">0</h1>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-4 d-flex services align-self-stretch pb-4 px-4 ftco-animate bg-grey">
                            <div class="media block-6 d-block text-center center-items">
                                <div class="media-body p-2 mt-3">
                                    <h3>Dominated Energy Level</h3>
                                    <h1 id="dominated-energy" class="text-center heading-font">0</h1>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <br>
                <div class="col-md-3 d-flex services align-self-stretch pb-4 px-4 ftco-animate bg-mairoon">
                    <div class="media block-6 d-block text-center center-items">
                        <div class="media-body p-2 mt-3 text-center">
                            <h3>Disgusted Faces</h3>
                            <h1 id="disgust" class="text-center heading-font">00</h1>
                        </div>
                    </div>
                </div>
                <div class="col-md-3 d-flex services align-self-stretch pb-4 px-4 ftco-animate bg-quarternary">
                    <div class="media block-6 d-block text-center center-items">
                        <div class="media-body p-2 mt-3">
                            <h3>Angry Faces</h3>
                            <h1 id="Angry" class="text-center heading-font">00</h1>
                        </div>
                    </div>
                </div>
                <div class="col-md-3 d-flex services align-self-stretch pb-4 px-4 ftco-animate bg-yellow">
                    <div class="media block-6 d-block text-center center-items">
                        <div class="media-body p-2 mt-3">
                            <h3>Total Happy Faces</h3>
                            <h1 id="Happy" class="text-center heading-font">00</h1>
                        </div>
                    </div>
                </div>
                <div class="col-md-3 d-flex services align-self-stretch pb-4 px-4 ftco-animate bg-sad">
                    <div class="media block-6 d-block text-center center-items">
                        <div class="media-body p-2 mt-3">
                            <h3>Sad Faces</h3>
                            <h1 id="Sad" class="text-center heading-font">00</h1>
                        </div>
                    </div>
                </div>
                <div class="col-md-3 d-flex services align-self-stretch pb-4 px-4 ftco-animate bg-surprise">
                    <div class="media block-6 d-block text-center center-items">
                        <div class="media-body p-2 mt-3">
                            <h3>Surprised Faces</h3>
                            <h1 id="Surprise" class="text-center heading-font">00</h1>
                        </div>
                    </div>
                </div>
                <div class="col-md-3 d-flex services align-self-stretch pb-4 px-4 ftco-animate bg-tertiary">
                    <div class="media block-6 d-block text-center center-items">
                        <div class="media-body p-2 mt-3">
                            <h3>Neutral Faces</h3>
                            <h1 id="Neutral" class="text-center heading-font">00</h1>
                        </div>
                    </div>
                </div>
                <div class="col-md-3 d-flex services align-self-stretch pb-4 px-4 ftco-animate bg-sleepy">
                    <div class="media block-6 d-block text-center center-items">
                        <div class="media-body p-2 mt-3">
                            <h3>Drowsy Faces</h3>
                            <h1 id="Drowsy" class="text-center heading-font">00</h1>
                        </div>
                    </div>
                </div>
                <div class="col-md-3 d-flex services align-self-stretch pb-4 px-4 ftco-animate bg-primary">
                    <div class="media block-6 d-block text-center center-items">
                        <div class="media-body p-2 mt-3">
                            <h3>Active Faces</h3>
                            <h1 id="Active" class="text-center heading-font">00</h1>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <br><br><br><br>
    </section>
    <script>
        let stream = null;
        let image_data_url = null;
        let interval = null;
        let predictions = [0, 0, 0, 0, 0, 0];
        let detections = [0, 0];
        let total_time = 0.0;
        let camera_button = document.querySelector("#start-camera");
        let video = document.querySelector("#video");
        let stop_button = document.querySelector("#stop-btn");
        let canvas = document.querySelector("#canvas");
        let twoD = canvas.getContext('2d');
        let check_expression = document.querySelector("#check-expression")
        let class_labels = ['Disgust', 'Angry', 'Happy', 'Sad', 'Surprise', 'Neutral']
        let drowsy = ['Active', 'Drowsy']
        camera_button.addEventListener('click', async function () {
            navigator.getMedia = ( navigator.getUserMedia || // use the proper vendor prefix
                navigator.webkitGetUserMedia ||
                navigator.mozGetUserMedia ||
                navigator.msGetUserMedia);

            navigator.getMedia({video: true}, async function() {
                // webcam is available
                document.getElementById("vide-sec").style.display = "block";
                document.getElementById("initial-btns").style.display = "none";
                stream = await navigator.mediaDevices.getUserMedia({video: true, audio: false});
                video.srcObject = stream;
                interval = setInterval(function () {
                    // total_time+=10000;
                    twoD.drawImage(video, 0, 0, canvas.width, canvas.height);
                    image_data_url = canvas.toDataURL('image/jpeg').replace("image/png", "image/octet-stream");
                    const blob = dataURItoBlob(image_data_url);
                    const data = sendData("http://44.202.24.183:8000/api/getfaceslist/", blob);
                }, 10000);
            }, function() {
                // webcam is not available
                swal("Oh Snap!", "Camera is not available!", "error");
            });
        });

        stop_button.addEventListener('click', function () {
            clearInterval(interval);
            stream.getTracks()[0].stop();
            document.getElementById("vide-sec").style.display = "none"
            let sum = detections.reduce((pv, cv) => pv + cv, 0);
            if (sum > 0) {
                for (let i = 0; i < predictions.length; i++) {
                    if (predictions[i] > 0) {
                        document.getElementById(class_labels[i]).innerHTML = ('0' + predictions[i]).slice(-2);
                    }
                }
                for (let i = 0; i < detections.length; i++) {
                    if (detections[i] > 0) {
                        document.getElementById(drowsy[i]).innerHTML = ('0' + detections[i]).slice(-2);
                    }
                }
                document.getElementById("total-faces").innerHTML = sum;
                let pred_index = predictions.indexOf(Math.max(...predictions));
                document.getElementById("dominated-emotion").innerHTML = class_labels[pred_index] + "<br>" + Math.round(predictions[pred_index] / sum * 100) + "%";
                let drowsy_index = detections.indexOf(Math.max(...detections));
                document.getElementById("dominated-energy").innerHTML = drowsy[drowsy_index] + "<br>" + Math.round(detections[drowsy_index] / sum * 100) + "%";
                document.getElementById('results').style.display = "block";
            } else {
                document.getElementById('results').style.display = "none";
            }
        });


        function dataURItoBlob(dataURI) {
            // convert base64/URLEncoded data component to raw binary data held in a string
            var byteString;
            if (dataURI.split(',')[0].indexOf('base64') >= 0)
                byteString = atob(dataURI.split(',')[1]);
            else
                byteString = unescape(dataURI.split(',')[1]);

            // separate out the mime component
            var mimeString = dataURI.split(',')[0].split(':')[1].split(';')[0];

            // write the bytes of the string to a typed array
            var ia = new Uint8Array(byteString.length);
            for (var i = 0; i < byteString.length; i++) {
                ia[i] = byteString.charCodeAt(i);
            }

            return new Blob([ia], {type: mimeString});
        }

        async function sendData(url, data) {
            const formData = new FormData();
            formData.append("image", data);

            await fetch(url, {
                dataType: 'file',
                contentType: 'multipart/form-data',
                processData: false,
                method: 'POST',
                body: formData
            }).then(r =>
                r.json()
            ).then(d => {
                // console.log(d);
                for (var i = 0; i < d.length; i++) {
                    pred = d[i].pred;
                    detc = d[i].detc;
                    predictions[pred] += 1;
                    detections[detc] += 1;
                }
            });
        }
    </script>
<section class="ftco-gallery">
    <div class="container-wrap">
        <div class="row no-gutters">
            <div class="col-md-3 ftco-animate">
                <span class="gallery img d-flex align-items-center"
                      style="background-image:url(images/happy-girl.jpg)">
                </span>
            </div>
            <div class="col-md-3 ftco-animate">
                <span class="gallery img d-flex align-items-center"
                      style="background-image:url(images/sleepy-man.jpg)">
                </span>
            </div>
            <div class="col-md-3 ftco-animate">
                <span class="gallery img d-flex align-items-center"
                      style="background-image:url(images/shocked-man.jpg)">
                </span>
            </div>
            <div class="col-md-3 ftco-animate">
                <span class="gallery img d-flex align-items-center"
                      style="background-image:url(images/angry-girl.jpg)">
                </span>
            </div>
        </div>
    </div>
</section>
<footer class="ftco-footer ftco-bg-dark ftco-section">
    <div class="container">
        <div class="row mb-5">
            <div class="col-md-6 col-lg-5">
                <div class="ftco-footer-widget mb-5">
                    <h2 class="ftco-heading-2">Have a Questions?</h2>
                    <div class="block-23 mb-3">
                        <ul>
                            <li><span class="icon icon-map-marker"></span><span class="text">GIFT University, near GIFT University Chowk, Lohian Wala, Gujranwala, Punjab 52250</span>
                            </li>
                            <li><a href="#"><span class="icon icon-phone"></span><span
                                            class="text">+92 300 1234567</span></a></li>
                            <li><a href="mailto:181370137@gift.edu.pk"><span class="icon icon-envelope"></span><span class="text"><span
                                    class="__cf_email__" data-cfemail="f39a9d959cb38a9c8681979c9e929a9ddd909c9e">181370137@gift.edu.pk</span></span></a>
                            </li>
                        </ul>
                    </div>
                </div>
            </div>
            <div class="col-md-6 col-lg-3">
                <div class="ftco-footer-widget mb-5 ml-md-4">
                    <h2 class="ftco-heading-2">Links</h2>
                    <ul class="list-unstyled">
                        <li><a href="index.html"><span class="ion-ios-arrow-round-forward mr-2"></span>Home</a></li>
                        <li><a href="click-predict.html"><span class="ion-ios-arrow-round-forward mr-2"></span>Click & Predict</a></li>
                        <li><a href="monitoring.html"><span class="ion-ios-arrow-round-forward mr-2"></span>Monitoring</a></li>
                        <li><a href="blog.html"><span class="ion-ios-arrow-round-forward mr-2"></span>Contact</a></li>
                        <li><a href="music.html"><span class="ion-ios-arrow-round-forward mr-2"></span>Contact</a></li>
                        <li><a href="about.html"><span class="ion-ios-arrow-round-forward mr-2"></span>About</a></li>
                    </ul>
                </div>
            </div>
            <div class="col-md-6 col-lg-3">
                <div class="ftco-footer-widget mb-5">
                    <h2 class="ftco-heading-2">Subscribe Us!</h2>
                    <form action="#" class="subscribe-form">
                        <div class="form-group">
                            <input type="text" class="form-control mb-2 text-center" placeholder="Enter email address">
                            <input type="submit" value="Subscribe" class="form-control submit px-3">
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </div>
</footer>


<script src="js/jquery.min.js"></script>
<script src="js/jquery-migrate-3.0.1.min.js%2bpopper.min.js%2bbootstrap.min.js.pagespeed.jc.6rS3Cn6ZxM.js"></script>
<script>eval(mod_pagespeed_YgNxllFXD4);</script>
<script>eval(mod_pagespeed_UDmpTSObsH);</script>
<script>eval(mod_pagespeed_uRER00OAmW);</script>
<script src="js/jquery.easing.1.3.js%2bjquery.waypoints.min.js%2bjquery.stellar.min.js%2bowl.carousel.min.js.pagespeed.jc.Mgo9OYOi5G.js"></script>
<script>eval(mod_pagespeed_1gCYGiHbM9);</script>
<script>eval(mod_pagespeed_8EvmmGDyCK);</script>
<script>eval(mod_pagespeed_1DoCc_EEAp);</script>
<script>eval(mod_pagespeed_2mnIkk1i4p);</script>
<script src="js/jquery.magnific-popup.min.js%2baos.js%2bjquery.animateNumber.min.js%2bscrollax.min.js%2bgoogle-map.js%2bmain.js.pagespeed.jc.eIhfEvsAmk.js"></script>
<script>eval(mod_pagespeed_bGDXmnGcnW);</script>
<script>eval(mod_pagespeed_UGjS7Lz9kp);</script>
<script>eval(mod_pagespeed_kYUzhmgmTg);</script>
<script>eval(mod_pagespeed_jIUsHblPht);</script>
<script>eval(mod_pagespeed_E5v$mbbxth);</script>
<script>eval(mod_pagespeed_wBb5LK83Ja);</script>
</body>
</html>